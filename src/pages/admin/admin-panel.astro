---
import Layout from '../../layouts/Layout.astro';
import Sidebar from '../../components/Sidebar.astro';
import Footer from '../../components/Footer.astro';
import Almacen from '../../components/Almacen';
import TazaCambio from '../../components/TazaCambio';
import InicioyCierreJornada from '../../components/InicioyCierreJornada';
import GestionUsuarios from '../../components/GestionUsuarios';
---

<Layout title="Panel de Administración">
  <div class="flex flex-col md:flex-row min-h-screen bg-gray-100">
    <Sidebar />
    <div class="flex-1 flex flex-col overflow-hidden">
      <header class="bg-white shadow z-10">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 pr-14 sm:pr-0">Panel de Administración</h1>
            <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-2 sm:space-y-0 w-full sm:w-auto">
              <a href="/ventas" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-center w-full sm:w-auto">
                Ir a Ventas
              </a>
              <button id="logoutButton" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded text-center w-full sm:w-auto">
                Salir
              </button>
            </div>
          </div>
        </div>
      </header>
      <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-200 p-4">
        <div id="almacen" class="hidden">
          <Almacen client:visible />
        </div>
        <div id="tazaCambio" class="hidden">
          <TazaCambio client:visible />
        </div>
        <div id="jornadaControl" class="hidden">
          <InicioyCierreJornada client:visible />
        </div>
        <div id="gestionUsuarios" class="hidden">
          <GestionUsuarios client:visible />
        </div>
        <div id="default">
          <h2 class="text-2xl font-bold mb-4">Bienvenido al Panel de Administración</h2>
          <p>Selecciona una opción del menú para comenzar.</p>
        </div>
      </main>
      <Footer />
    </div>
  </div>
</Layout>

<script>
  // Add logout functionality
  const logoutButton = document.getElementById('logoutButton');
  if (logoutButton) {
    logoutButton.addEventListener('click', () => {
      // Clear local storage
      localStorage.removeItem('authToken');
      localStorage.removeItem('user');
      
      // Redirect to login page
      window.location.href = '/';
    });
  }

  // Function to show the selected component and hide others
  function showComponent(target: any) {
    const components = ['almacen', 'tazaCambio', 'jornadaControl', 'gestionUsuarios', 'default'];
    components.forEach(comp => {
      const element = document.getElementById(comp);
      if (element) {
        if (comp === target) {
          element.classList.remove('hidden');
        } else {
          element.classList.add('hidden');
        }
      }
    });
  }

  // Listen for the custom event from the sidebar
  window.addEventListener('sidebarLinkClicked', (event) => {
    const target = (event as CustomEvent).detail.target;
    showComponent(target);
  });

  // Show default content on page load
  showComponent('default');
</script>

